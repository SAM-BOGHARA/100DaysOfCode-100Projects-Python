<p><strong>Your Story</strong></p>
<p>Today you will become a doctor, but not just any doctor. You will become Dr Ignaz Semmelweis, a Hungarian physician
    born in 1818 who worked in the Vienna General Hospital. </p>
<figure><img
        src="https://udemy-images.s3.amazonaws.com:443/redactor/raw/2020-10-23_10-15-15-050a33ada93a9b72a2e40d4713872e42.png">
</figure>
<p>In the past, people didn't know about bacteria, germs, or viruses. People illness was caused by "bad air" or evil
    spirits. But in the 1800s Doctors started looking more at anatomy, doing autopsies and making arguments based on
    data. Dr Semmelweis suspected that something was going wrong with the procedures at Vienna General Hospital. Dr
    Semmelweis wanted to figure out why so many women in maternity wards were dying from childbed fever (i.e., <a
        href="https://en.wikipedia.org/wiki/Postpartum_infections" rel="noopener noreferrer" target="_blank">puerperal
        fever</a>).</p>
<p><br></p>
<p><strong>Today you'll learn: </strong></p>
<ul>
    <li>
        <p>How to make a compelling argument using data</p>
    </li>
    <li>
        <p>How to superimpose histograms to show differences in distributions</p>
    </li>
    <li>
        <p>How to use a Kernel Density Estimate (KDE)&nbsp;to show a graphic estimate of a distribution.</p>
    </li>
    <li>
        <p>How to use scipy and test for statistical significance by looking at p-values. </p>
    </li>
    <li>
        <p>How to highlight different parts of a time series chart in Matplotib.</p>
    </li>
    <li>
        <p>How to add and configure a Legend in Matplotlib.</p>
    </li>
    <li>
        <p>Use NumPy's <code>.where()</code>&nbsp;function to process elements depending on a condition.</p>
    </li>
</ul>
<p><br></p>
<p><strong>Download and add the Notebook to Google Drive</strong></p>
<p>As usual, download the .zip file from this lesson and extract it. Add the .ipynb file into your Google Drive and open
    it as a Google Colaboratory notebook.</p>
<p><br></p>
<p><strong>Add the Data to the Notebook</strong></p>
<p>The .zip file also includes two .csv files. This is the data for the project. Add this file to your notebook.</p>
<p><br></p>

<h1>2</h1>
<p>You (aka Dr Semmelweis)&nbsp;are working at Vienna General Hospital. Let's take a closer look at the data you've been
    collecting on the number of births and maternal deaths throughout the 1840s. </p>
<figure><img height="307"
        src="https://udemy-images.s3.amazonaws.com:443/redactor/raw/2020-10-23_10-38-09-9527e9a9d46107327b4fa76246c62b81.png"
        width="427"></figure>
<p><br></p>
<h4>Challenge 1:&nbsp;Preliminary Data Exploration</h4>
<ul>
    <li>
        <p>What is the shape of <code>df_yearly</code> and <code>df_monthly</code>? How many rows and columns?</p>
    </li>
    <li>
        <p>What are the column names?</p>
    </li>
    <li>
        <p>Which years are included in the dataset?</p>
    </li>
    <li>
        <p>Are there any NaN values or duplicates?</p>
    </li>
    <li>
        <p>What were the average number of births that took place per month?</p>
    </li>
    <li>
        <p>What were the average number of deaths that took place per month?</p>
    </li>
</ul>
<p><br></p>
<p>.</p>
<p>.</p>
<p>..</p>
<p>...</p>
<p>..</p>
<p>.</p>
<p>.</p>
<p><br></p>
<p><strong>Solution to Challenge 1</strong></p>
<p>Using <code>.shape</code>, <code>.head()</code>, <code>.tail()</code> we see that the dataset covers the years 1841
    to 1849. The two tables report the total number of births and the total number of deaths. Interestingly, the yearly
    data breaks the number of birthds and deaths down by clinic. </p>
<figure><img
        src="https://udemy-images.s3.amazonaws.com:443/redactor/raw/2020-10-23_10-42-54-fb1af5f4e2bd231b283dabdaca8cc4c3.png">
</figure>
<p>We see that there are no NaN&nbsp;values in either of the DataFrames. We can verify this either with using
    <code>.info()</code> or using <code>.isna().values.any()</code>. </p>
<figure><img height="528"
        src="https://udemy-images.s3.amazonaws.com:443/redactor/raw/2020-10-23_10-47-41-c48e37522afaa8f220c19a26a4c7ab73.png"
        width="418"></figure>
<p>There are also no duplicate entries. In other words, the dataset appears to be clean.</p>
<figure><img
        src="https://udemy-images.s3.amazonaws.com:443/redactor/raw/2020-10-23_10-48-41-6018a072a58ca120945dab55dbbdc651.png">
</figure>
<p>Using <code>.describe()</code> allows us to view some interesting statistics at a glance. We see that on average
    there were about 267 births and 22.47 deaths per month. </p>
<figure><img height="412"
        src="https://udemy-images.s3.amazonaws.com:443/redactor/raw/2020-10-23_10-52-34-6870fc442c6051d51df38af7904c328b.png"
        width="592"></figure>
<p> </p>
<h4>Challenge 2:&nbsp;Percentage of Women Dying in Childbirth</h4>
<p>How dangerous was childbirth in the 1840s in Vienna?</p>
<ul>
    <li>
        <p>Using the annual data, calculate the percentage of women giving birth who died throughout the 1840s at the
            hospital.</p>
    </li>
</ul>
<p>In comparison, the United States recorded 18.5 maternal deaths per 100,000 or 0.018% in 2013 <a
        href="https://en.wikipedia.org/wiki/Maternal_death#:~:text=The%20US%20has%20the%20%22highest,17.8%20per%20100%2C000%20in%202009"
        rel="noopener noreferrer" target="_blank">(source).</a></p>
<p><br></p>
<p>.</p>
<p>.</p>
<p>..</p>
<p>...</p>
<p>..</p>
<p>.</p>
<p>.</p>
<p><br></p>
<p><br></p>
<p><strong>Solution to Challenge 2</strong></p>
<p>Childbirth was very risky! About 7.08% of women died 💀 in the 1840s (compared to 0.018% in the US in 2013). </p>
<pre class="prettyprint linenums">prob = df_yearly.deaths.sum() / df_yearly.births.sum() * 100
print(f'Chances of dying in the 1840s in Vienna: {prob:.3}%')</pre>
<p>If someone gave me a bag of 100 M&amp;Ms and told me that 7 of them would kill me, I'd (probably) pass on those
    M&amp;Ms 🤭. Just saying.</p>
<p><br></p>
<h4>Challenge 3:&nbsp;Visualise the Total Number of Births 🤱 and Deaths 💀 over Time</h4>
<p>Create a <a href="https://matplotlib.org/3.3.2/api/_as_gen/matplotlib.pyplot.plot.html" rel="noopener noreferrer"
        target="_blank">Matplotlib chart</a> with twin y-axes. It should look something like this:</p>
<figure><img
        src="https://udemy-images.s3.amazonaws.com:443/redactor/raw/2020-10-23_11-06-31-76e4e6fbe90cd4edb47e9dee6eb3da5f.png">
</figure>
<ul>
    <li>
        <p>Format the x-axis using locators for the years and months (Hint: we did this in the Google Trends notebook)
        </p>
    </li>
    <li>
        <p>Set the range on the x-axis so that the chart lines touch the y-axes</p>
    </li>
    <li>
        <p>Add gridlines</p>
    </li>
    <li>
        <p>Use <code>skyblue</code> and <code>crimson</code> for the line colours</p>
    </li>
    <li>
        <p>Use a dashed line style for the number of deaths</p>
    </li>
    <li>
        <p>Change the line thickness to 3 and 2 for the births and deaths respectively.</p>
    </li>
    <li>
        <p>Do you notice anything in the late 1840s?</p>
    </li>
</ul>
<p><br></p>
<p>.</p>
<p>.</p>
<p>..</p>
<p>...</p>
<p>..</p>
<p>.</p>
<p>.</p>
<p><br></p>
<p><strong>Solution to Challenge 3</strong></p>
<p>Just as in previous notebooks we can use <code>.twinx()</code>&nbsp;to create to y-axes. Then it's just a matter of
    adding a gird with <code>.grid()</code> and configuring the look of our plots with the <code>color</code>,
    <code>linewidth</code>, and <code>linestyle</code> parameters. </p>
<pre class="prettyprint linenums">plt.figure(figsize=(14,8), dpi=200)
plt.title('Total Number of Monthly Births and Deaths', fontsize=18)

ax1 = plt.gca()
ax2 = ax1.twinx()

ax1.grid(color='grey', linestyle='--')

ax1.plot(df_monthly.date, 
         df_monthly.births, 
         color='skyblue', 
         linewidth=3)

ax2.plot(df_monthly.date, 
         df_monthly.deaths, 
         color='crimson', 
         linewidth=2, 
         linestyle='--')

plt.show()</pre>
<figure><img
        src="https://udemy-images.s3.amazonaws.com:443/redactor/raw/2020-10-23_11-11-50-6276fcca4bbc46fa057415c170ba9189.png">
</figure>
<p>To get the tickmarks showing up on the x-axis, we need to use <code>mdates</code> and Matplotlib's locators.</p>
<pre class="prettyprint linenums"># Create locators for ticks on the time axis
years = mdates.YearLocator()
months = mdates.MonthLocator()
years_fmt = mdates.DateFormatter('%Y') </pre>
<p>We can then use the locators in our chart:</p>
<pre class="prettyprint linenums">plt.figure(figsize=(14,8), dpi=200)
plt.title('Total Number of Monthly Births and Deaths', fontsize=18)
plt.yticks(fontsize=14)
plt.xticks(fontsize=14, rotation=45)

ax1 = plt.gca()
ax2 = ax1.twinx()

ax1.set_ylabel('Births', color='skyblue', fontsize=18)
ax2.set_ylabel('Deaths', color='crimson', fontsize=18)

# Use Locators
ax1.set_xlim([df_monthly.date.min(), df_monthly.date.max()])
ax1.xaxis.set_major_locator(years)
ax1.xaxis.set_major_formatter(years_fmt)
ax1.xaxis.set_minor_locator(months)

ax1.grid(color='grey', linestyle='--')

ax1.plot(df_monthly.date, 
         df_monthly.births, 
         color='skyblue', 
         linewidth=3)

ax2.plot(df_monthly.date, 
         df_monthly.deaths, 
         color='crimson', 
         linewidth=2, 
         linestyle='--')

plt.show()</pre>
<figure><img
        src="https://udemy-images.s3.amazonaws.com:443/redactor/raw/2020-10-23_11-16-35-039658c53b985fcbb11f9ffa26d074fd.png">
</figure>
<p>What we see is that something happened after 1847. The total number of deaths seems to have dropped, despite an
    increasing number of births!&nbsp;🤔</p>
<p><br></p>

<h1>3</h1>
<p><strong>Welcome to your workplace...</strong></p>
<p>There are two maternity wards at the Vienna General Hospital: clinic 1 and clinic 2. Clinic 1 was staffed by all-male
    doctors and medical students, and clinic 2 was staffed by female midwives.</p>
<figure><img
        src="https://udemy-images.s3.amazonaws.com:443/redactor/raw/2020-10-23_11-22-51-ff500f4a9967079931e0e692b7c45ad3.png">
</figure>
<h4>Challenge 1:&nbsp;The Yearly Data Split by Clinic</h4>
<p>Let's turn our attention to the annual data. Use plotly to create line charts of the births and deaths of the two
    different clinics at the Vienna General Hospital.</p>
<ul>
    <li>
        <p>Which clinic is bigger or more busy judging by the number of births?</p>
    </li>
    <li>
        <p>Has the hospital had more patients over time?</p>
    </li>
    <li>
        <p>What was the highest number of deaths recorded in clinic 1 and clinic 2?</p>
    </li>
</ul>
<p><br></p>
<p>.</p>
<p>.</p>
<p>..</p>
<p>...</p>
<p>..</p>
<p>.</p>
<p>.</p>
<p><br></p>
<p><strong>Solution to Challenge 1</strong></p>
<p>To show two line charts side by side we can use plotly and provide the clinic column as the <code>color</code>. </p>
<pre class="prettyprint linenums">line = px.line(df_yearly, 
    x='year', 
    y='births',
    color='clinic',
    title='Total Yearly Births by Clinic')

line.show()</pre>
<p>We see that more and more women gave birth at the hospital over the years. Clinic 1, which was staffed by male
    doctors and medical students was also the busier or simply the larger ward. More births took place in clinic 1 than
    in clinic 2. </p>
<figure><img
        src="https://udemy-images.s3.amazonaws.com:443/redactor/raw/2020-10-23_11-31-13-b5897c5011eadac9f54e6956b30d4f97.png">
</figure>
<p>We also see that, not only were more people born in clinic 1, more people also died in clinic 1. </p>
<pre class="prettyprint linenums">line = px.line(df_yearly, 
    x='year', 
    y='deaths',
    color='clinic',
    title='Total Yearly Deaths by Clinic')

line.show()</pre>
<figure><img
        src="https://udemy-images.s3.amazonaws.com:443/redactor/raw/2020-10-23_11-32-45-1f1c814dd89d9e8102ff7642a53a3ecd.png">
</figure>
<p>To compare apples and apples, we need to look at the proportion of deaths per clinic. </p>
<p><br></p>
<h4>Challenge 2:&nbsp;Calculate the Proportion of Deaths at Each Clinic</h4>
<p>Calculate the proportion of maternal deaths per clinic. That way we can compare like with like.</p>
<ul>
    <li>
        <p>Work out the percentage of deaths for each row in the <code>df_yearly</code> DataFrame by adding a column
            called "pct_deaths".</p>
    </li>
    <li>
        <p>Calculate the average maternal death rate for clinic 1 and clinic 2 (i.e., the total number of deaths per the
            total number of births).</p>
    </li>
    <li>
        <p>Create another plotly line chart to see how the percentage varies year over year with the two different
            clinics.</p>
    </li>
    <li>
        <p>Which clinic has a higher proportion of deaths?</p>
    </li>
    <li>
        <p>What is the highest monthly death rate in clinic 1 compared to clinic 2?</p>
    </li>
</ul>
<p><br></p>
<p>.</p>
<p>.</p>
<p>..</p>
<p>...</p>
<p>..</p>
<p>.</p>
<p>.</p>
<p><br></p>
<p><strong>Solution to Challenge 2</strong></p>
<p>We can add a new column that has the percentage of deaths for each row like this:&nbsp;</p>
<pre class="prettyprint linenums">df_yearly['pct_deaths'] = df_yearly.deaths / df_yearly.births</pre>
<p>The average death rate for the entire time period for clinic 1 is:</p>
<pre class="prettyprint linenums">clinic_1 = df_yearly[df_yearly.clinic == 'clinic 1']
avg_c1 = clinic_1.deaths.sum() / clinic_1.births.sum() * 100
print(f'Average death rate in clinic 1 is {avg_c1:.3}%.')</pre>
<p>9.92%. In comparison, clinic 2 which was staffed by midwives had a much lower death rate of 3.88% over the course of
    the entire period. Hmm... 🤔</p>
<pre class="prettyprint linenums">clinic_2 = df_yearly[df_yearly.clinic == 'clinic 2']
avg_c2 = clinic_2.deaths.sum() / clinic_2.births.sum() * 100
print(f'Average death rate in clinic 2 is {avg_c2:.3}%.')</pre>
<p>Once again, let's see this on a chart</p>
<pre class="prettyprint linenums">line = px.line(df_yearly, 
    x='year', 
    y='pct_deaths',
    color='clinic',
    title='Proportion of Yearly Deaths by Clinic')

line.show()</pre>
<p>1842 was a rough year. About 16% of women died in clinic 1 and about 7.6% of women died in clinic 2. </p>
<figure><img
        src="https://udemy-images.s3.amazonaws.com:443/redactor/raw/2020-10-23_11-48-48-f1ea588ddc802796ce504f8cae08a844.png">
</figure>
<p>Still, clinic 2 had a consistently lower death rate than clinic 1! This is what puzzled and frustrated Dr Semmelweis.
</p>
<p><br></p>
<p><strong>The story continues...</strong></p>
<p>At first, Dr Semmelweis thought that the position of the women giving birth was the issue. In clinic 2, the midwives'
    clinic, women gave birth on their sides. In the doctors' clinic, women gave birth on their backs. So, Dr.
    Semmelweis, had women in the doctors' clinic give birth on their sides. However, this had no effect on the death
    rate. </p>
<p>Next, Dr Semmelweis noticed that whenever someone on the ward died, a priest would walk through clinic 1, past the
    women's beds ringing a bell 🔔. Perhaps the priest and the bell ringing terrified the women so much after birth that
    they developed a fever, got sick and died. Dr Semmelweis had the priest change his route and stop ringing the bell
    🔕. Again, this had no effect. </p>
<p>At this point, Dr Semmelweis was so frustrated he went on holiday to Venice. Perhaps a short break would clear his
    head. When Semmelweis returned from his vacation, he was told that one of his colleagues, a pathologist, had fallen
    ill and died. His friend had pricked his finger while doing an autopsy on a woman who had died from childbed fever
    and subsequently got very sick himself and died. 😮</p>
<p>Looking at the pathologist's symptoms, Semmelweis realised the pathologist died from the same thing as the women he
    had autopsied.&nbsp; This was his breakthrough: anyone could get sick from childbed fever, not just women giving
    birth! </p>
<p>This is what led to Semmelweis' new theory. Perhaps there were little pieces or particles of a corpse that the
    doctors and medical students were getting on their hands while dissecting the cadavers during an autopsy. And when
    the doctors delivered the babies in clinic 1, these particles would get inside the women giving birth who would then
    develop the disease and die.</p>

<h1>4</h1>
<p>In June 1947, Dr Semmelweis ordered everyone on his medical staff to start cleaning their hands and instruments not
    just with soap and water but with a chlorine solution (he didn't know it at the time, but chlorine is an amazing
    disinfectant). The reason Dr Semmelweis actually chose the chlorine was that he wanted to get rid of any smell on
    doctors' hands after an autopsy. No one knew anything about bacteria, germs or viruses at the time. </p>
<p><br></p>
<h4>Challenge 1: The Effect of Handwashing</h4>
<ul>
    <li>
        <p>Add a column called "pct_deaths" to <code>df_monthly</code> that has the percentage of deaths per birth for
            each row.</p>
    </li>
    <li>
        <p>Create two subsets from the <code>df_monthly</code> data: before and after Dr Semmelweis ordered washing
            hand.</p>
    </li>
    <li>
        <p>Calculate the average death rate prior to June 1947.</p>
    </li>
    <li>
        <p>Calculate the average death rate after June 1947.</p>
    </li>
</ul>
<p><br></p>
<h4>Challenge 2: Calculate a Rolling Average of the Death Rate</h4>
<p>Create a DataFrame that has the 6-month rolling average death rate prior to mandatory handwashing.</p>
<p><em>Hint</em>: You'll need to set the dates as the index in order to avoid the date column being dropped during the
    calculation</p>
<p><br></p>
<h4>Challenge 3:&nbsp;Highlighting Subsections of a Line Chart</h4>
<p>Copy-paste and then modify the Matplotlib chart from before to plot the monthly death rates (instead of the total
    number of births and deaths). The chart should look something like this:</p>
<figure><img
        src="https://udemy-images.s3.amazonaws.com:443/redactor/raw/2020-10-23_12-27-28-063144e4acbc37b96bfd66f6f25f75f3.png">
</figure>
<p><br></p>
<ul>
    <li>
        <p>Add 3 separate lines to the plot: the death rate before handwashing, after handwashing, and the 6-month
            moving average before handwashing.</p>
    </li>
    <li>
        <p>Show the monthly death rate before handwashing as a thin dashed black line.</p>
    </li>
    <li>
        <p>Show the moving average as a thicker, crimson line.</p>
    </li>
    <li>
        <p>Show the rate after handwashing as a skyblue line with round markers.</p>
    </li>
    <li>
        <p>Look at the <a href="https://matplotlib.org/3.1.1/api/_as_gen/matplotlib.pyplot.legend.html"
                rel="noopener noreferrer" target="_blank">code snippet in the documentation to see how you can add a
                legend</a> to the chart.</p>
    </li>
</ul>
<p><br></p>
<p><br></p>
<p>.</p>
<p>.</p>
<p>..</p>
<p>...</p>
<p>..</p>
<p>.</p>
<p>.</p>
<p><br></p>
<p><strong>Solution to Challenge 1</strong></p>
<p>We can add a column with the proportion of deaths per birth like so:</p>
<pre class="prettyprint linenums">df_monthly['pct_deaths'] = df_monthly.deaths/df_monthly.births</pre>
<p>Then we can create two subsets based on the <code>handwashing_start</code> date. </p>
<pre class="prettyprint linenums">before_washing = df_monthly[df_monthly.date &lt; handwashing_start]
after_washing = df_monthly[df_monthly.date &gt;= handwashing_start]</pre>
<p>The death rate per birth dropped dramatically after handwashing started - from close to 10.53% to 2.15%. We can use
    the colon and dot inside a print statement to determine the number of digits we'd like to print out from a number.
</p>
<pre class="prettyprint linenums">bw_rate = before_washing.deaths.sum() / before_washing.births.sum() * 100
aw_rate = after_washing.deaths.sum() / after_washing.births.sum() * 100
print(f'Average death rate before 1847 was {bw_rate:.4}%')
print(f'Average death rate AFTER 1847 was {aw_rate:.3}%')</pre>
<p><br></p>
<p><strong>Solution to Challenge 2</strong></p>
<p>To work out the moving 6-month average we first set the date column as the index. Then we can use the same Pandas
    functions as in the Google Trends notebook. </p>
<pre class="prettyprint linenums">roll_df = before_washing.set_index('date')
roll_df = roll_df.rolling(window=6).mean()</pre>
<p><br></p>
<p><strong>Solution to Challenge 3</strong></p>
<p>After copy-pasting the previous code for the Matplotlib chart, we just need to change a few things. First, we remove
    the twin axes. And instead, we plot the three different lines on the same axis. To create the legend, we supply a
    label to the <code>.plot()</code> function and capture return value in a variable. It's important to notice that
    <code>.plot()</code> returns more than one thing, so we need to use a comma (<code>,</code>) since we're only
    grabbing the first item. We can then feed these handles into <code>plt.legend()</code>. </p>
<pre class="prettyprint linenums">plt.figure(figsize=(14,8), dpi=200)
plt.title('Percentage of Monthly Deaths over Time', fontsize=18)
plt.yticks(fontsize=14)
plt.xticks(fontsize=14, rotation=45)

plt.ylabel('Percentage of Deaths', color='crimson', fontsize=18)

ax = plt.gca()
ax.xaxis.set_major_locator(years)
ax.xaxis.set_major_formatter(years_fmt)
ax.xaxis.set_minor_locator(months)
ax.set_xlim([df_monthly.date.min(), df_monthly.date.max()])

plt.grid(color='grey', linestyle='--')

ma_line, = plt.plot(roll_df.index, 
                    roll_df.pct_deaths, 
                    color='crimson', 
                    linewidth=3, 
                    linestyle='--',
                    label='6m Moving Average')
bw_line, = plt.plot(before_washing.date, 
                    before_washing.pct_deaths,
                    color='black', 
                    linewidth=1, 
                    linestyle='--', 
                    label='Before Handwashing')
aw_line, = plt.plot(after_washing.date, 
                    after_washing.pct_deaths, 
                    color='skyblue', 
                    linewidth=3, 
                    marker='o',
                    label='After Handwashing')

plt.legend(handles=[ma_line, bw_line, aw_line],
           fontsize=18)

plt.show()</pre>
<figure><img
        src="https://udemy-images.s3.amazonaws.com:443/redactor/raw/2020-10-23_12-26-50-27dd134e94624962bdb420ddb176e825.png">
</figure>

<h1>5</h1>
<p>There are even more powerful arguments we can make to convince our fellow doctors in clinic 1 of the virtues of
    handwashing. The first are statistics regarding the mean monthly death rate. The second are compelling
    visualisations to accompany the statistics.</p>
<h4>Challenge 1:&nbsp;Calculate the Difference in the Average Monthly Death Rate</h4>
<ul>
    <li>
        <p>What was the average percentage of monthly deaths before handwashing (i.e., before June 1847)?</p>
    </li>
    <li>
        <p>What was the average percentage of monthly deaths after handwashing was made obligatory?</p>
    </li>
    <li>
        <p>By how much did handwashing reduce the average chance of dying in childbirth in percentage terms?</p>
    </li>
    <li>
        <p>How do these numbers compare to the average for all the 1840s that we calculated earlier?</p>
    </li>
    <li>
        <p>How many times lower are the chances of dying after handwashing compared to before?</p>
    </li>
</ul>
<p><br></p>
<p>.</p>
<p>.</p>
<p>..</p>
<p>...</p>
<p>..</p>
<p>.</p>
<p>.</p>
<p><br></p>
<p><strong>Solution to Challenge 1</strong></p>
<p>A lot of statistical tests rely on comparing features of distributions, like the mean. We see that the average death
    rate before handwashing was 10.5%. After handwashing was made obligatory, the average death rate was 2.11%. The
    difference is massive. Handwashing decreased the average death rate by 8.4%, a 5x improvement. 😮</p>
<pre class="prettyprint linenums">avg_prob_before = before_washing.pct_deaths.mean() * 100
    print(f'Chance of death during childbirth before handwashing: {avg_prob_before:.3}%.')
    
    avg_prob_after = after_washing.pct_deaths.mean() * 100
    print(f'Chance of death during childbirth AFTER handwashing: {avg_prob_after:.3}%.')
    
    mean_diff = avg_prob_before - avg_prob_after
    print(f'Handwashing reduced the monthly proportion of deaths by {mean_diff:.3}%!')
    
    times = avg_prob_before / avg_prob_after
    print(f'This is a {times:.2}x improvement!')</pre>
<p><br></p>
<h4>Challenge 2: Using Box Plots to Show How the Death Rate Changed Before and After Handwashing</h4>
<p>The statistic above is impressive, but how do we show it graphically?&nbsp;With a box plot we can show how the
    quartiles, minimum, and maximum values changed in addition to the mean. </p>
<ul>
    <li>
        <p>Use <a href="https://numpy.org/doc/stable/reference/generated/numpy.where.html" rel="noopener noreferrer"
                target="_blank">NumPy's <code>.where()</code> function</a> to add a column to <code>df_monthly</code>
            that shows if a particular date was before or after the start of handwashing.</p>
    </li>
    <li>
        <p>Then use plotly to create box plot of the data before and after handwashing.</p>
    </li>
    <li>
        <p>How did key statistics like the mean, max, min, 1st and 3rd quartile changed as a result of the new policy
        </p>
    </li>
</ul>
<p><br></p>
<p>.</p>
<p>.</p>
<p>..</p>
<p>...</p>
<p>..</p>
<p>.</p>
<p>.</p>
<p><br></p>
<p><strong>Solution to Challenge 2</strong></p>
<p>The easiest way to create a box plot is to have a column in our DataFrame that shows the rows' "category" (i.e., was
    it before or after obligatory handwashing). NumPy allows us to easily test for a condition and add a column of data.
</p>
<pre
    class="prettyprint linenums">df_monthly['washing_hands'] = np.where(df_monthly.date &lt; handwashing_start, 'No', 'Yes')</pre>
<p>Now we can use plotly:</p>
<pre class="prettyprint linenums">box = px.box(df_monthly, 
                 x='washing_hands', 
                 y='pct_deaths',
                 color='washing_hands',
                 title='How Have the Stats Changed with Handwashing?')
    
    box.update_layout(xaxis_title='Washing Hands?',
                      yaxis_title='Percentage of Monthly Deaths',)
    
    box.show()</pre>
<figure><img
        src="https://udemy-images.s3.amazonaws.com:443/redactor/raw/2020-10-23_14-39-42-eb859925d7e636d7244c6b410bad919b.png">
</figure>
<p>The plot shows us the same data as our Matplotlib chart, but from a different perspective. Here we also see the
    massive spike in deaths in late 1842. Over 30%&nbsp;of women who gave birth that month died in hospital. What we
    also see in the box plot is how not only did the average death rate come down, but so did the overall range - we
    have a lower max and 3rd quartile too. Let's take a look at a histogram to get a better sense of the distribution.
</p>
<p><br></p>
<h4>Challenge 3: Use Histograms to Visualise the Monthly Distribution of Outcomes</h4>
<p>Create a <a href="https://plotly.com/python/histograms/" rel="noopener noreferrer" target="_blank">plotly
        histogram</a> to show the monthly percentage of deaths.</p>
<ul>
    <li>
        <p>Use docs to check out the available parameters. Use the <a
                href="https://plotly.github.io/plotly.py-docs/generated/plotly.express.histogram.html"
                rel="noopener noreferrer" target="_blank"><code>color</code> parameter</a> to display two overlapping
            histograms.</p>
    </li>
    <li>
        <p>The time period of handwashing is shorter than not handwashing. Change <code>histnorm</code> to
            <code>percent</code> to make the time periods comparable.</p>
    </li>
    <li>
        <p>Make the histograms slightly transparent</p>
    </li>
    <li>
        <p>Experiment with the number of bins on the histogram. Which number works well in communicating the range of
            outcomes?</p>
    </li>
    <li>
        <p>Just for fun, display your box plot on the top of the histogram using the <code>marginal</code> parameter</p>
    </li>
</ul>
<p><br></p>
<p><br></p>
<p>.</p>
<p>.</p>
<p>..</p>
<p>...</p>
<p>..</p>
<p>.</p>
<p>.</p>
<p><br></p>
<p><strong>Solution to Challenge 3</strong></p>
<p>To create our histogram, we once again make use of the color parameter. This creates two separate histograms for us.
    When we set the opacity to 0.6 or so we can clearly see how the histograms overlap. The trick to getting a
    sensible-looking histogram when you have a very different number of observations is to set the <code>histnorm</code>
    to 'percent'. That way the histogram with more observations won't completely overshadow the shorter series.</p>
<pre class="prettyprint linenums">hist = px.histogram(df_monthly, 
                       x='pct_deaths', 
                       color='washing_hands',
                       nbins=30,
                       opacity=0.6,
                       barmode='overlay',
                       histnorm='percent',
                       marginal='box',)
    
    hist.update_layout(xaxis_title='Proportion of Monthly Deaths',
                       yaxis_title='Count',)
    
    hist.show()</pre>
<p>I&nbsp;quite like how in plotly we can display our box plot from earlier at the top. </p>
<figure><img
        src="https://udemy-images.s3.amazonaws.com:443/redactor/raw/2020-10-23_14-49-58-3961b13cff88b2866bba7da183716a04.png">
</figure>
<p>Now, we have only about 98 data points or so, so our histogram looks a bit jagged. It's not a smooth bell-shaped
    curve. However, we can estimate what the distribution would look like with a Kernel Density Estimate (KDE).</p>
<p><br></p>
<h4>Challenge 4: Use a Kernel Density Estimate (KDE) to visualise a smooth distribution</h4>
<p>Use <a href="https://seaborn.pydata.org/generated/seaborn.kdeplot.html" rel="noopener noreferrer"
        target="_blank">Seaborn's <code>.kdeplot()</code></a> to create two kernel density estimates of the pct_deaths,
    one for before handwashing and one for after.</p>
<ul>
    <li>
        <p>Use the <code>shade</code> parameter to give your two distributions different colours.</p>
    </li>
    <li>
        <p>What weakness in the chart do you see when you just use the default parameters?</p>
    </li>
    <li>
        <p>Use the <code>clip</code> parameter to address the problem.</p>
    </li>
</ul>
<p><br></p>
<p>.</p>
<p>.</p>
<p>..</p>
<p>...</p>
<p>..</p>
<p>.</p>
<p>.</p>
<p><br></p>
<p><strong>Solution to Challenge 4</strong></p>
<p>To create two bell-shaped curves of the estimated distributions of the death rates we just call
    <code>.kdeplot()</code> twice. </p>
<pre class="prettyprint linenums">plt.figure(dpi=200)
    # By default the distribution estimate includes a negative death rate!
    sns.kdeplot(before_washing.pct_deaths, shade=True)
    sns.kdeplot(after_washing.pct_deaths, shade=True)
    plt.title('Est. Distribution of Monthly Death Rate Before and After Handwashing')
    plt.show()</pre>
<p>However, the problem is that we end up with a negative monthly death rate on the left tail. The doctors would be very
    surprised indeed if a corpse came back to life after an autopsy! 🧟‍♀️ </p>
<figure><img
        src="https://udemy-images.s3.amazonaws.com:443/redactor/raw/2020-10-23_14-59-53-0b2eb0809a34c6eb94983086e631800c.png">
</figure>
<p>The solution is to specify a lower bound of 0 for the death rate. </p>
<pre class="prettyprint linenums">plt.figure(dpi=200)
    sns.kdeplot(before_washing.pct_deaths, 
                shade=True,
                clip=(0,1))
    sns.kdeplot(after_washing.pct_deaths, 
                shade=True,
                clip=(0,1))
    plt.title('Est. Distribution of Monthly Death Rate Before and After Handwashing')
    plt.xlim(0, 0.40)
    plt.show()</pre>
<figure><img
        src="https://udemy-images.s3.amazonaws.com:443/redactor/raw/2020-10-23_15-00-50-d951f463f0f6b86e096672a3d6a05e77.png">
</figure>
<p>Now that we have an idea of what the two distributions look like, we can further strengthen our argument for
    handwashing by using a statistical test. We can test whether our distributions ended up looking so different purely
    by chance (i.e., the lower death rate is just an accident) or if the 8.4% difference in the average death rate is
    <strong>statistically significant</strong>. </p>
<p><br></p>
<p><br></p>
<h4>Challenge 5: Use a T-Test to Show Statistical Significance</h4>
<p>Use a t-test to determine if the differences in the means are statistically significant or purely due to chance.</p>
<p>If the p-value is less than 1% then we can be 99% certain that handwashing has made a difference to the average
    monthly death rate.</p>
<ul>
    <li>
        <p>Import <code>stats</code> from scipy</p>
    </li>
    <li>
        <p>Use the <a href="https://docs.scipy.org/%5Ddoc/scipy/reference/generated/scipy.stats.ttest_ind.html"
                rel="noopener noreferrer" target="_blank"><code>.ttest_ind()</code> function</a> to calculate the
            t-statistic and the p-value</p>
    </li>
    <li>
        <p>Is the difference in the average proportion of monthly deaths statistically significant at the 99% level?</p>
    </li>
</ul>
<p><br></p>
<p>.</p>
<p>.</p>
<p>..</p>
<p>...</p>
<p>..</p>
<p>.</p>
<p>.</p>
<p><br></p>
<p><strong>Solution to Challenge 5</strong></p>
<p>The first step is to import stats from scipy</p>
<pre class="prettyprint linenums">import scipy.stats as stats</pre>
<p>When we calculate the p_value we see that it is 0.0000002985 or .00002985% which is far below even 1%. In other
    words, the difference in means is highly statistically significant and we can go ahead on publish our research paper
    😊 </p>
<pre class="prettyprint linenums">t_stat, p_value = stats.ttest_ind(a=before_washing.pct_deaths, 
                                      b=after_washing.pct_deaths)
    print(f'p-palue is {p_value:.10f}')
    print(f't-statstic is {t_stat:.4}')</pre>
<p><br></p>

<h1>6</h1>
<p>Well done, Doctor! With your thorough analysis and compelling visualisations of the handwashing data, you've
    convinced the hospital board to continue making hand washing obligatory! </p>
<p><strong>Today you've learned </strong></p>
<ul>
    <li>
        <p>How to use histograms to visualise distributions</p>
    </li>
    <li>
        <p>How to superimpose histograms on top of each other even when the data series have different lengths</p>
    </li>
    <li>
        <p>How to use a to smooth out kinks in a histogram and visualise a distribution with a Kernel Density Estimate
            (KDE)</p>
    </li>
    <li>
        <p>How to improve a KDE&nbsp;by specifying boundaries on the estimates</p>
    </li>
    <li>
        <p>How to use scipy and test for statistical significance by looking at p-values. </p>
    </li>
    <li>
        <p>How to highlight different parts of a time series chart in Matplotib.</p>
    </li>
    <li>
        <p>How to add and configure a Legend in Matplotlib.</p>
    </li>
    <li>
        <p>Use NumPy's <code>.where()</code>&nbsp;function to process elements depending on a condition.</p>
    </li>
</ul>
<p><strong>The Tragic Story of Dr Semmelweis</strong></p>
<p>Gather round, gather round.&nbsp;Now I'll tell you how our story ends. Despite the incredible evidence in favour of
    Dr Semmelweis' theory - that childbed fever was caused by some "substance" (which today we know as bacteria) from
    autopsy room corpses - was rejected by the medical community at the time. But why?!&nbsp;</p>
<p>Part of the reason is that Semmelweis was not very tactful. He made it look like doctors were <em>giving</em>
    childbed fever to women (which they in fact were). This is not something people wanted to hear. </p>
<p>However, he also published his data in the form of long tables <strong>without</strong> any data visualisations:</p>
<figure><img
        src="https://udemy-images.s3.amazonaws.com:443/redactor/raw/2020-10-23_15-25-37-28877dab514343720243ddca867f7da4.png">
</figure>
<p>The long tables made it very hard to see what's actually going on! Also, at the time statistics and statistical
    arguments were quite uncommon in the field of medicine. </p>
<p>Eventually, Dr Semmelweis belligerent campaigning made him some powerful and influential enemies. He lost his job at
    the Vienna hospital, and doctors gave up washing their hands with chlorine. As Dr Semmelweis grew older he got even
    angrier and eventually quite "strange". This was either the immense frustration or possibly a result of another
    disease like Alzheimer's or syphilis. In 1965, at the age of 47, Dr Semmelweis was committed to a mental asylum. And
    at the asylum, he was probably beaten since he eventually died of sepsis, a complication of an infection in the
    bloodstream. The tragic irony is that sepsis is a similar kind of disease that he fought so hard to prevent in women
    who died from childbed fever. It wasn't until 20 years later with Louis Pasteur's work on germ theory that Dr
    Semmelweis' work gained acceptance. RIP Dr Semmelweis. </p>
<p>Here's how you can wash your hands like a surgeon:</p>
<figure><img
        src="https://udemy-images.s3.amazonaws.com:443/redactor/raw/2020-10-23_15-21-50-a2cee16c7b72811c007ed921900d481f.gif">
</figure>
<p>You can download the completed code for today in this lesson.</p>